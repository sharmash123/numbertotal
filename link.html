<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Store Grid Table</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #f4f9fe;
    margin: 0;
    padding: 30px 8px 120px 8px;
}
h1 {
    margin-bottom: 18px;
    color: #273356;
}
.controls {
    margin-bottom: 12px;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px 10px;
}
.controls input[type='text'], .controls input[type='number'] {
    width: 170px;
    max-width: 90vw;
    font-size: 16px;
    padding: 6px 10px;
    border: 1px solid #b5c7e6;
    border-radius: 5px;
}
.controls button {
    font-size: 15px;
    padding: 6px 12px;
    background: #3a5bea;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.18s;
}
.controls button:hover { background: #2233a2; }
.table-wrap { overflow-x: auto; width: 100%; margin-top:6px; }
table {
    border-collapse: collapse;
    background: #fff;
    border-radius: 8px;
    margin: 0 auto;
    box-shadow: 0 2px 14px #ccc7;
    width: 100%;
    table-layout: fixed; /* evenly distribute columns */
}
th, td {
    border: 1.5px solid #333;
    height: 57px;
    font-size: 22px;
    text-align: center;
    vertical-align: middle;
    padding: 0;
    overflow: hidden;
    word-break: break-word;
    cursor: pointer;
}
td { background: #f8fafc; font-weight: bold; position: relative; user-select: none; }
.opendigit { color: #2186cc; font-weight: bold; font-size: 24px; display:inline-block; margin-right:4px; }
.closedigit { color: #eb2323; font-weight: bold; font-size: 24px; display:inline-block; }
.cell-index { position: absolute; left: 4px; top: 4px; font-size: 11px; color: #6b7280; font-weight: 600; opacity: 0.8; }
.empty-faint { color: #9aa7bf; font-weight: 600; font-size: 16px; }
@media (max-width: 900px) {
    td, th { font-size: 17px; height: 43px; }
    .opendigit,.closedigit { font-size:19px; }
}
@media (max-width: 600px) {
    td, th { font-size: 14px; height: 40px; }
    .opendigit,.closedigit { font-size:14px; }
    .table-wrap { overflow-x: hidden; }
}
.save-section {
    position: fixed;
    left: 0; right: 0; bottom: 0;
    background: #e6eaf4;
    padding: 12px;
    box-shadow: 0 -2px 8px #bbc7;
    display: flex;
    align-items: center;
    gap: 12px;
    justify-content: center;
    z-index: 40;
}
.save-section input { font-size: 16px; padding: 6px 11px; border: 1.1px solid #8fb1e5; border-radius: 4px; max-width: 200px; }
.save-section button{ font-size: 16px; background: #2fcf37; color: #fff; border: none; padding: 6px 14px; border-radius:5px; cursor: pointer; }
.save-section button:hover{ background: #139020;}
.small-muted { font-size:12px; color:#475569; margin-left:6px; }
</style>
</head>
<body>
<h1>Store Grid Table (Responsive)</h1>

<div class="controls">
    <label>Rows: <input id="rowsInput" type="number" value="100" min="1" max="2000" /></label>
    <label>Cols: <input id="colsInput" type="number" value="7" min="1" max="50" /></label>
    <button id="resizeBtn">Modify Size</button>
    <button id="showIndexBtn">Show Index: <span id="showIndexState">OFF</span></button>
</div>

<div class="controls">
    <input id="openInput" placeholder="Open: 2-digit numbers or **/xx (space separated)">
    <button id="openBtn">Open</button>
    <input id="closeInput" placeholder="Close: 2-digit numbers or **/xx (space separated)">
    <button id="closeBtn">Close</button>
    <button id="clearOpenBtn">Clear Open</button>
    <button id="clearCloseBtn">Clear Close</button>
    <button id="clearAllBtn">Clear All</button>
</div>

<div class="table-wrap">
    <table id="gridTable" role="grid" aria-label="Store Grid"></table>
</div>

<div class="save-section">
    <input id="username" type="text" placeholder="Enter Your Name" />
    <button id="saveBtn">Save to store.html</button>
    <span id="savemsg" style="color:green;display:none;margin-left:10px;"></span>
    <span class="small-muted">Tip: click a cell to edit its Open/Close values</span>
</div>

<script>
// CN formula
function calculateCN(num) {
    if (num === '**' || num.toLowerCase() === 'xx') return '*';
    if (!num || num.length !== 2 || !/^\d{2}$/.test(num)) return '';
    let a = parseInt(num[0],10), b = parseInt(num[1],10);
    let step1 = (a+b)%10;
    let step2 = (a+a)%10;
    return (step1+step2)%10;
}

let ROWS=100, COLS=7;
let openDigits = Array(ROWS*COLS).fill('');
let closeDigits = Array(ROWS*COLS).fill('');
const table = document.getElementById('gridTable');
let SHOW_INDEX=false;

function renderTable() {
    table.innerHTML='';
    for(let r=0;r<ROWS;r++){
        let tr=document.createElement('tr');
        for(let c=0;c<COLS;c++){
            let td=document.createElement('td');
            let idx=r*COLS+c;
            td.dataset.idx=idx;
            let open=openDigits[idx]||'';
            let close=closeDigits[idx]||'';
            if(open||close){
                td.innerHTML=`<span class="opendigit">${open}</span><span class="closedigit">${close}</span>`;
            }else{
                td.innerHTML=SHOW_INDEX?`<div class="cell-index">${idx}</div><div class="empty-faint">${idx}</div>`:'';
            }
            td.onclick=onCellClick;
            tr.appendChild(td);
        }
        table.appendChild(tr);
    }
}
renderTable();

// Resize
document.getElementById('resizeBtn').onclick=function(){
    const newRows=Math.min(2000,Math.max(1,parseInt(document.getElementById('rowsInput').value,10)||1));
    const newCols=Math.min(50,Math.max(1,parseInt(document.getElementById('colsInput').value,10)||1));
    const newSize=newRows*newCols;
    const oldOpen=openDigits.slice();
    const oldClose=closeDigits.slice();
    ROWS=newRows; COLS=newCols;
    openDigits=Array(newSize).fill('');
    closeDigits=Array(newSize).fill('');
    for(let i=0;i<Math.min(oldOpen.length,newSize);i++) openDigits[i]=oldOpen[i];
    for(let i=0;i<Math.min(oldClose.length,newSize);i++) closeDigits[i]=oldClose[i];
    renderTable();
};

// Open / Close buttons
document.getElementById('openBtn').onclick=function(){
    let nums=document.getElementById('openInput').value.trim().split(/\s+/);
    openDigits.fill('');
    nums.forEach((num,idx)=>{if(idx<openDigits.length&&(num==='**'||num.toLowerCase()==='xx'||/^\d{2}$/.test(num))) openDigits[idx]=calculateCN(num);});
    renderTable();
};
document.getElementById('closeBtn').onclick=function(){
    let nums=document.getElementById('closeInput').value.trim().split(/\s+/);
    closeDigits.fill('');
    nums.forEach((num,idx)=>{if(idx<closeDigits.length&&(num==='**'||num.toLowerCase()==='xx'||/^\d{2}$/.test(num))) closeDigits[idx]=calculateCN(num);});
    renderTable();
};

// Clear buttons
document.getElementById('clearOpenBtn').onclick=function(){ openDigits.fill(''); renderTable(); };
document.getElementById('clearCloseBtn').onclick=function(){ closeDigits.fill(''); renderTable(); };
document.getElementById('clearAllBtn').onclick=function(){ openDigits.fill(''); closeDigits.fill(''); renderTable(); };

// Show index toggle
document.getElementById('showIndexBtn').onclick=function(){
    SHOW_INDEX=!SHOW_INDEX;
    document.getElementById('showIndexState').textContent=SHOW_INDEX?'ON':'OFF';
    this.style.background=SHOW_INDEX?'#16a34a':'#3a5bea';
    renderTable();
};

// Cell edit
function onCellClick(){
    const idx=parseInt(this.dataset.idx,10);
    const prevOpen=openDigits[idx]||'';
    const prevClose=closeDigits[idx]||'';
    const inputOpen=prompt(`Cell ${idx}\nOpen value:`,prevOpen);
    if(inputOpen===null) return;
    const inputClose=prompt(`Cell ${idx}\nClose value:`,prevClose);
    if(inputClose===null) return;
    function setVal(input){ if(!input||input.trim()==='') return ''; input=input.trim(); return (input==='**'||input.toLowerCase()==='xx'||/^\d{2}$/.test(input))?calculateCN(input):''; }
    openDigits[idx]=setVal(inputOpen);
    closeDigits[idx]=setVal(inputClose);
    renderTable();
}

// Save
document.getElementById('saveBtn').onclick=function(){
    let name=document.getElementById('username').value.trim();
    if(!name){ alert('Enter your name!'); return; }
    let content=`<html><head><meta charset='UTF-8'><title>Saved Grid for ${name}</title>
    <style>body{font-family:sans-serif;background:#f4f9fe;padding:20px;} table{border-collapse:collapse;} td,th{border:1px solid #333;width:40px;height:40px;text-align:center;} .opendigit{color:#2186cc;font-weight:bold;} .closedigit{color:#eb2323;font-weight:bold;} @media(max-width:700px){td,th{width:24px;height:24px;font-size:12px;}}</style>
    </head><body><h2>Grid for ${name}</h2><table>`;
    for(let r=0;r<ROWS;r++){ content+='<tr>'; for(let c=0;c<COLS;c++){ let idx=r*COLS+c; let open=openDigits[idx]?`<span class="opendigit">${openDigits[idx]}</span>`:''; let close=closeDigits[idx]?`<span class="closedigit">${closeDigits[idx]}</span>`:''; content+=`<td>${open}${close}</td>`; } content+='</tr>'; }
    content+='</table></body></html>';
    const blob=new Blob([content],{type:"text/html"});
    const url=URL.createObjectURL(blob);
    let a=document.createElement('a'); a.href=url; a.download='store.html'; a.click();
    setTimeout(()=>URL.revokeObjectURL(url),3000);
    const msgEl=document.getElementById('savemsg');
    msgEl.textContent='Saved!'; msgEl.style.display='inline';
    setTimeout(()=>{msgEl.style.display='none';},2000);
};
</script>
</body>
</html>
