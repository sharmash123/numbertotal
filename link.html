<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Number-Cal: Mobile Transform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f1f5f9; margin: 0; padding: 0; }
        
        /* Forces the table to stay within mobile screen width */
        .table-container { 
            width: 100vw;
            overflow-x: auto; 
            background: white;
            -webkit-overflow-scrolling: touch;
        }
        
        table { 
            border-collapse: collapse; 
            width: 100%; 
            table-layout: fixed; /* Ensures equal column widths */
        }
        
        td { 
            border: 1px solid #cbd5e1; 
            text-align: center; 
            vertical-align: middle;
            padding: 2px 0;
            height: 50px; /* Compact for mobile */
        }

        /* Original Number (Top) */
        .original-num {
            font-size: 1.2rem;
            font-weight: 800;
            display: block;
            line-height: 1;
        }

        /* Double-Transform Number (Bottom) */
        .transform-num {
            font-size: 0.95rem;
            font-weight: 800;
            color: #16a34a; 
            display: block;
            line-height: 1;
            margin-top: 2px;
        }

        .text-red { color: #dc2626 !important; }
        .text-black { color: #1e293b; }

        .row-id {
            background: #f8fafc;
            font-size: 0.6rem;
            color: #94a3b8;
            width: 25px;
        }

        @media (min-width: 768px) {
            td { height: 75px; }
            .original-num { font-size: 1.3rem; }
            .transform-num { font-size: 0.85rem; }
        }
    </style>
</head>
<body class="pb-10">
    <header class="bg-slate-900 text-white p-3 flex justify-between items-center sticky top-0 z-50">
        <h1 class="text-base font-bold">Number-Cal <span class="text-green-400">View</span></h1>
        <a href="index.html" class="text-[10px] bg-blue-600 px-3 py-1 rounded-full font-bold">EDITOR</a>
    </header>

    <main>
        <div class="p-2">
            <select id="chartSelector" class="w-full border-2 border-slate-200 rounded-lg p-2 text-sm font-bold mb-4">
                <option value="">-- Select Chart --</option>
            </select>
        </div>

        <div id="viewContainer" class="hidden">
            <div class="table-container shadow-xl">
                <table id="displayGrid"></table>
            </div>
        </div>
    </main>

    <script>
        // Logic from your Editor
        const redPairs = {0:5, 1:6, 2:7, 3:8, 4:9, 5:0, 6:1, 7:2, 8:3, 9:4};

        function isRed(num) {
            if (!num || num.length !== 2 || num === '**') return num === '**';
            const a = parseInt(num[0]), b = parseInt(num[1]);
            return a === b || redPairs[a] === b;
        }

        // Calculation: (Digit + Digit) mod 10
        function getDoubleMod(val) {
            if (!val || val.length !== 2 || val === '**') return "";
            const d1 = (parseInt(val[0]) + parseInt(val[0])) % 10;
            const d2 = (parseInt(val[1]) + parseInt(val[1])) % 10;
            return `${d1}${d2}`;
        }

        function init() {
            const history = JSON.parse(localStorage.getItem('chartHistory')) || {};
            const select = document.getElementById('chartSelector');
            Object.keys(history).forEach(name => {
                const opt = document.createElement('option');
                opt.value = name; opt.textContent = name;
                select.appendChild(opt);
            });
        }

        document.getElementById('chartSelector').onchange = (e) => {
            const history = JSON.parse(localStorage.getItem('chartHistory')) || {};
            const chart = history[e.target.value];
            if (chart) {
                document.getElementById('viewContainer').classList.remove('hidden');
                renderGrid(chart.data, chart.rows, chart.cols);
            }
        };

        function renderGrid(data, rows, cols) {
            const table = document.getElementById('displayGrid');
            table.innerHTML = '';
            
            for(let r=0; r<rows; r++) {
                // Skips empty rows at the end to keep mobile performance fast
                if (r > 100 && (!data[r] || !data[r].some(x => x))) continue;

                const tr = document.createElement('tr');
                const idTd = document.createElement('td');
                idTd.className = 'row-id';
                idTd.innerText = r + 1;
                tr.appendChild(idTd);

                for(let c=0; c<cols; c++) {
                    const td = document.createElement('td');
                    const cell = data[r] && data[r][c];
                    
                    if (cell) {
                        const val = (typeof cell === 'object') ? cell.val : cell;
                        const redStatus = isRed(val);
                        const transform = getDoubleMod(val);
                        
                        td.innerHTML = `
                            <span class="original-num ${redStatus ? 'text-red' : 'text-black'}">${val}</span>
                            <span class="transform-num">${transform}</span>
                        `;
                    }
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
        }

        init();
    </script>
</body>
</html>
