<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Number-Cal: Mobile Transform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f1f5f9; overflow-x: hidden; }
        
        /* Mobile-First Table Container */
        .table-container { 
            width: 100%;
            overflow-x: auto; /* Allows side-swiping if columns are many */
            background: white; 
            border-radius: 8px; 
            border: 1px solid #cbd5e1;
            -webkit-overflow-scrolling: touch;
        }
        
        table { 
            border-collapse: collapse; 
            width: 100%; 
            table-layout: fixed; /* Forces columns to be equal width */
        }
        
        /* Flexible Cell Sizing */
        td { 
            border: 1px solid #cbd5e1; 
            text-align: center; 
            vertical-align: middle;
            padding: 4px 1px;
            height: 55px; /* Compact height for mobile */
        }

        /* Large Screen Adjustments */
        @media (min-width: 768px) {
            td { height: 80px; }
            .original-num { font-size: 1.4rem !important; }
            .transform-num { font-size: 0.9rem !important; }
        }

        /* Typography optimized for small screens */
        .original-num {
            font-size: 1rem;
            font-weight: 800;
            display: block;
            line-height: 1;
        }

        .transform-num {
            font-size: 0.7rem;
            font-weight: 800;
            color: #16a34a; 
            display: block;
            line-height: 1;
            margin-top: 3px;
        }

        .text-red { color: #dc2626 !important; }
        .text-black { color: #1e293b; }

        /* Row Number Styling */
        .row-num {
            background-color: #f8fafc;
            font-size: 0.65rem;
            font-weight: 600;
            color: #64748b;
            width: 30px; /* Small fixed width for row ID */
        }
    </style>
</head>
<body class="pb-10">
    <header class="bg-slate-900 text-white p-4 shadow-lg flex justify-between items-center">
        <h1 class="text-lg font-bold">Number<span class="text-green-400">-Cal</span></h1>
        <a href="index.html" class="text-xs bg-slate-700 px-3 py-1.5 rounded-full font-bold">Editor</a>
    </header>

    <main class="p-2">
        <div class="bg-white p-3 rounded-xl shadow-sm mb-4">
            <select id="chartSelector" class="w-full border-2 border-slate-100 rounded-lg p-2 text-sm font-bold outline-none">
                <option value="">-- Select Chart --</option>
            </select>
        </div>

        <div id="viewContainer" class="hidden">
            <div class="table-container shadow-md">
                <table id="displayGrid"></table>
            </div>
        </div>
    </main>

    <script>
        // Red Pair Logic from your index.html
        const redPairs = {0:5, 1:6, 2:7, 3:8, 4:9, 5:0, 6:1, 7:2, 8:3, 9:4};
        
        // Green Transform Map
        const greenMap = {'1':'6','6':'1','2':'7','7':'2','3':'8','8':'3','4':'9','9':'4','5':'0','0':'5'};

        function checkRedStatus(num) {
            if (!num || num.length !== 2 || num === '**') return num === '**';
            const a = parseInt(num[0]), b = parseInt(num[1]);
            return a === b || redPairs[a] === b;
        }

        function getGreenTransform(val) {
            if (!val || val.length !== 2 || val === '**') return "";
            return (greenMap[val[0]] || val[0]) + (greenMap[val[1]] || val[1]);
        }

        function init() {
            const history = JSON.parse(localStorage.getItem('chartHistory')) || {};
            const select = document.getElementById('chartSelector');
            Object.keys(history).forEach(name => {
                const opt = document.createElement('option');
                opt.value = name; opt.textContent = name;
                select.appendChild(opt);
            });
        }

        document.getElementById('chartSelector').onchange = (e) => {
            const history = JSON.parse(localStorage.getItem('chartHistory')) || {};
            const chart = history[e.target.value];
            if (chart) {
                document.getElementById('viewContainer').classList.remove('hidden');
                renderGrid(chart.data, chart.rows, chart.cols);
            }
        };

        function renderGrid(data, rows, cols) {
            const table = document.getElementById('displayGrid');
            table.innerHTML = '';
            
            for(let r=0; r<rows; r++) {
                // Only render rows that have at least one piece of data to save mobile space
                const hasData = data[r] && data[r].some(cell => cell !== null);
                if(!hasData && r > 50) continue; 

                const tr = document.createElement('tr');
                
                // Add Row Number
                const rowTd = document.createElement('td');
                rowTd.className = 'row-num';
                rowTd.innerText = r + 1;
                tr.appendChild(rowTd);

                for(let c=0; c<cols; c++) {
                    const td = document.createElement('td');
                    const cell = data[r] && data[r][c];
                    
                    if (cell) {
                        const val = (typeof cell === 'object') ? cell.val : cell;
                        const isRed = checkRedStatus(val);
                        const transformed = getGreenTransform(val);
                        
                        td.innerHTML = `
                            <span class="original-num ${isRed ? 'text-red' : 'text-black'}">${val}</span>
                            <span class="transform-num">${transformed}</span>
                        `;
                    }
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
        }

        init();
    </script>
</body>
</html>
