<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number-Cal: Transform & Pairs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f1f5f9; }
        
        .table-container { 
            overflow: auto; 
            background: white; 
            border-radius: 12px; 
            border: 2px solid #e2e8f0; 
            max-height: 80vh;
        }
        
        table { border-collapse: collapse; width: 100%; table-layout: fixed; min-width: 600px; }
        
        td { 
            border: 1px solid #cbd5e1; 
            text-align: center; 
            vertical-align: middle;
            position: relative;
            padding: 4px 0;
            height: 60px;
        }

        @media (min-width: 768px) {
            td { height: 75px; }
        }

        .original-num {
            font-size: 2rem;
            font-weight: 800;
            display: block;
            line-height: 1.2;
        }

        .transform-num {
            font-size: 1.30rem;
            font-weight: 800;
            color: #16a34a; 
            display: block;
            line-height: 1.2;
            margin-top: 2px;
        }

        /* Red color definition matching your index.html */
        .text-red { color: #dc2626 !important; font-weight: 800; }
        .text-black { color: #1e293b; }

        header { background: linear-gradient(to right, #1e1b4b, #312e81); }
    </style>
</head>
<body class="pb-10">
    <header class="text-white p-4 shadow-xl flex flex-col md:flex-row justify-between items-center gap-4">
        <h1 class="text-xl font-bold">Number-Cal <span class="text-green-400">Pair-View</span></h1>
        <nav class="flex gap-4">
            <a href="index.html" class="text-xs font-bold border border-white/30 px-3 py-1 rounded">Editor</a>
        </nav>
    </header>

    <main class="p-2 md:p-6">
        <div class="bg-white p-4 rounded-2xl shadow-md mb-6">
            <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">Select Existing Chart</label>
            <select id="chartSelector" class="w-full border-2 border-slate-100 rounded-lg p-2 font-bold outline-none focus:border-green-500 transition">
                <option value="">-- Choose a Chart --</option>
            </select>
        </div>

        <div id="viewContainer" class="hidden">
            <div class="table-container shadow-2xl">
                <table id="displayGrid"></table>
            </div>
        </div>
    </main>

    <script>
        // 1. Red Pair Logic from your index.html
        const redPairs = {0:5, 1:6, 2:7, 3:8, 4:9, 5:0, 6:1, 7:2, 8:3, 9:4};
        
        // 2. Pair Mapping for the GREEN number (as requested earlier)
        const greenTransformMap = {
            '1':'6', '6':'1', '2':'7', '7':'2', '3':'8', '8':'3', '4':'9', '9':'4', '5':'0', '0':'5'
        };

        let gridData = [];
        let rows = 0, cols = 0;

        // Function to check if number should be RED (from your index.html)
        function checkRedStatus(num) {
            if (!num || num.length !== 2 || !/^\d{2}$/.test(num)) return false;
            const a = parseInt(num[0]), b = parseInt(num[1]);
            return a === b || redPairs[a] === b;
        }

        // Logic for the small green number (Pair Transform)
        function getGreenTransform(val) {
            if (!val || val.length !== 2 || val === '**') return "";
            const d1 = greenTransformMap[val[0]] || val[0];
            const d2 = greenTransformMap[val[1]] || val[1];
            return d1 + d2;
        }

        function init() {
            const history = JSON.parse(localStorage.getItem('chartHistory')) || {};
            const select = document.getElementById('chartSelector');
            Object.keys(history).forEach(name => {
                const opt = document.createElement('option');
                opt.value = name; opt.textContent = name;
                select.appendChild(opt);
            });
        }

        document.getElementById('chartSelector').onchange = (e) => {
            const history = JSON.parse(localStorage.getItem('chartHistory')) || {};
            const chart = history[e.target.value];
            if (chart) {
                gridData = chart.data; 
                rows = chart.rows; 
                cols = chart.cols;
                document.getElementById('viewContainer').classList.remove('hidden');
                renderGrid();
            }
        };

        function renderGrid() {
            const table = document.getElementById('displayGrid');
            table.innerHTML = '';
            
            for(let r=0; r<rows; r++) {
                const tr = document.createElement('tr');
                for(let c=0; c<cols; c++) {
                    const td = document.createElement('td');
                    const cell = gridData[r] && gridData[r][c];
                    
                    if (cell) {
                        const val = (typeof cell === 'object') ? cell.val : cell;
                        
                        // Apply the RED condition from your index.html logic
                        const isRedNumber = checkRedStatus(val) || (cell.val === '**');
                        const transformed = getGreenTransform(val);
                        
                        td.innerHTML = `
                            <span class="original-num ${isRedNumber ? 'text-red' : 'text-black'}">${val}</span>
                            <span class="transform-num">${transformed}</span>
                        `;
                    }
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
        }

        init();
    </script>
</body>
</html>
