<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Grid Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Arial', sans-serif; }
        .table-container { overflow-x: auto; margin: 0 auto; max-width: 100%; }
        table { border-collapse: collapse; margin: 0 auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); min-width: 500px; }
        td, th { border: 2px solid #000; text-align: center; font-size: 24px; background-color: #ffffff; position: relative; vertical-align: middle; padding: 8px; border-radius: 4px; }
        td { width: 120px; height: 80px; cursor: pointer; }
        th.row-number { width: 60px; height: 80px; font-size: 18px; background-color: #f3f4f6; }
        th.col-header { width: 120px; height: 40px; font-size: 16px; background-color: #f3f4f6; }
        th.empty-corner { width: 60px; height: 40px; border: none; background-color: transparent; }
        input.cell-input { width: 100%; height: 100%; font-size: 24px; text-align: center; border: none; outline: none; background: transparent; font-weight: bold; }
        .number-value { font-size: 28px; font-weight: bold; display: block; line-height: 1.2; }
        .symbol { color: red; font-weight: bold; font-size: 32px; }
        .controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin: 1rem 0; }
        .controls input { padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; width: 100px; }
        .controls button { padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .controls button:hover { background: #0056b3; }
        @media (max-width: 768px) {
            td, th.col-header { width: 80px; height: 60px; font-size: 18px; padding: 4px; }
            th.row-number { width: 40px; height: 60px; font-size: 14px; }
            .number-value { font-size: 20px; }
            .symbol { font-size: 24px; }
            .controls { gap: 0.5rem; }
            .controls input { width: 80px; }
        }
        @media (max-width: 480px) {
            td, th.col-header { width: 60px; height: 50px; font-size: 16px; padding: 2px; }
            th.row-number { width: 30px; height: 50px; font-size: 12px; }
            .number-value { font-size: 18px; }
            .symbol { font-size: 20px; }
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <header class="bg-gray-800 text-white p-4 flex justify-between items-center flex-wrap mb-4">
        <h1 class="text-xl md:text-2xl font-bold mb-2 md:mb-0">Number Grid Editor</h1>
        <nav class="flex gap-4">
            <a href="index.html" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-300">
                Charts
            </a>
            <a href="store.html" class="bg-yellow-500 hover:bg-yellow-600 text-gray-800 font-semibold py-2 px-4 rounded-full transition-colors duration-300">
                Store
            </a>
        </nav>
    </header>
    <div class="controls">
        <input type="number" id="rowsInput" value="100" min="1" max="1000" placeholder="Rows">
        <input type="number" id="colsInput" value="7" min="1" max="20" placeholder="Cols">
        <button id="modifyBtn">Modify Grid</button>
        <button id="clearBtn">Clear Grid</button>
        <button id="saveBtn">Save Chart</button>
    </div>
    <div class="table-container">
        <table id="gridTable">
            <thead>
                <tr>
                    <th class="empty-corner"></th>
                    <th class="col-header">Col 1</th>
                    <th class="col-header">Col 2</th>
                    <th class="col-header">Col 3</th>
                    <th class="col-header">Col 4</th>
                    <th class="col-header">Col 5</th>
                    <th class="col-header">Col 6</th>
                    <th class="col-header">Col 7</th>
                </tr>
            </thead>
            <tbody id="gridBody">
                <!-- Rows will be generated here -->
            </tbody>
        </table>
    </div>

    <script>
        let rows = 100;
        let cols = 7;
        let gridData = Array.from({ length: rows }, () => Array(cols).fill(''));
        let isAdvancing = false;
        let currentChartName = null;

        function renderGrid() {
            const tbody = document.getElementById('gridBody');
            tbody.innerHTML = '';
            for (let r = 0; r < rows; r++) {
                const tr = document.createElement('tr');
                // Row number
                const rowTh = document.createElement('th');
                rowTh.className = 'row-number';
                rowTh.textContent = r + 1;
                tr.appendChild(rowTh);
                for (let c = 0; c < cols; c++) {
                    const td = document.createElement('td');
                    td.dataset.row = r;
                    td.dataset.col = c;
                    renderCell(td, r, c);
                    tr.appendChild(td);
                }
                tbody.appendChild(tr);
            }
            attachCellListeners();
        }

        function renderCell(td, r, c) {
            const value = gridData[r][c];
            td.innerHTML = '';
            if (value === '**') {
                td.innerHTML = '<span class="symbol">**</span>';
            } else if (/^\d{2}$/.test(value)) {
                td.innerHTML = `<span class="number-value">${value}</span>`;
            } else {
                td.innerHTML = '';
            }
        }

        function attachCellListeners() {
            const cells = document.querySelectorAll('#gridTable td');
            cells.forEach(td => {
                td.addEventListener('click', function() {
                    if (isAdvancing) return;
                    const r = parseInt(this.dataset.row);
                    const c = parseInt(this.dataset.col);
                    editCell(this, r, c);
                });
            });
        }

        function editCell(td, r, c) {
            if (isAdvancing) return;
            isAdvancing = true;
            td.innerHTML = '';
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'cell-input';
            input.maxLength = 2;
            input.value = gridData[r][c] || '';
            input.pattern = '[0-9]{2}|\\*\\*';
            td.appendChild(input);
            input.focus();
            input.select();

            const handleInput = (e) => {
                const val = e.target.value;
                // Restrict to numbers and *
                e.target.value = val.replace(/[^0-9*]/g, '');
                if (val.length === 2 && (val === '**' || /^\d{2}$/.test(val))) {
                    input.removeEventListener('input', handleInput);
                    saveAndAdvance(r, c, td, input);
                }
            };

            const handleKeydown = (e) => {
                if (e.key === 'Enter') {
                    input.removeEventListener('input', handleInput);
                    saveAndAdvance(r, c, td, input);
                } else if (e.key === 'Escape') {
                    input.removeEventListener('input', handleInput);
                    renderCell(td, r, c);
                    isAdvancing = false;
                }
            };

            const handleBlur = () => {
                input.removeEventListener('input', handleInput);
                saveAndAdvance(r, c, td, input);
            };

            input.addEventListener('input', handleInput);
            input.addEventListener('keydown', handleKeydown);
            input.addEventListener('blur', handleBlur);

            // Reset flag after short delay
            setTimeout(() => { isAdvancing = false; }, 100);
        }

        function saveAndAdvance(r, c, td, input) {
            const val = input.value.trim();
            if (val === '**' || /^\d{2}$/.test(val)) {
                gridData[r][c] = val;
            } else {
                gridData[r][c] = '';
            }
            renderCell(td, r, c);
            // Advance to next cell
            let nextR = r;
            let nextC = c + 1;
            if (nextC >= cols) {
                nextC = 0;
                nextR++;
            }
            if (nextR < rows) {
                setTimeout(() => {
                    const nextTd = document.querySelector(`td[data-row="${nextR}"][data-col="${nextC}"]`);
                    if (nextTd) {
                        editCell(nextTd, nextR, nextC);
                    } else {
                        isAdvancing = false;
                    }
                }, 50);
            } else {
                isAdvancing = false;
            }
        }

        function saveChart() {
            if (!currentChartName) {
                currentChartName = prompt('Enter Chart Name:');
                if (!currentChartName || currentChartName.trim() === '') {
                    alert('Chart name is required.');
                    return;
                }
                currentChartName = currentChartName.trim();
            }
            const history = JSON.parse(localStorage.getItem('chartHistory')) || {};
            history[currentChartName] = {
                rows: rows,
                cols: cols,
                data: JSON.parse(JSON.stringify(gridData))
            };
            localStorage.setItem('chartHistory', JSON.stringify(history));
            alert(`Chart "${currentChartName}" saved successfully!`);
        }

        document.getElementById('modifyBtn').addEventListener('click', () => {
            const newRows = parseInt(document.getElementById('rowsInput').value) || rows;
            const newCols = parseInt(document.getElementById('colsInput').value) || cols;
            if (newRows < 1 || newCols < 1) return;
            rows = newRows;
            cols = newCols;
            // Update headers
            const headerRow = document.querySelector('#gridTable thead tr');
            // Remove extra headers
            while (headerRow.children.length > cols + 1) { // +1 for empty corner
                headerRow.removeChild(headerRow.lastChild);
            }
            // Add missing headers
            for (let i = headerRow.children.length - 1; i < cols; i++) {
                const th = document.createElement('th');
                th.className = 'col-header';
                th.textContent = `Col ${i + 1}`;
                headerRow.appendChild(th);
            }
            gridData = Array.from({ length: rows }, () => Array(cols).fill(''));
            renderGrid();
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            gridData = Array.from({ length: rows }, () => Array(cols).fill(''));
            renderGrid();
        });

        document.getElementById('saveBtn').addEventListener('click', saveChart);

        // Initial render
        renderGrid();
    </script>
</body>
</html>
