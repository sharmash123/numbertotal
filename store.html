<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    
    <title>Number-Cal: Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #6b7280, #1e40af, #9333ea);
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .store-body {
            padding-top: 60px; /* Ensure content clears the fixed header */
        }
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            animation: slideDown 0.6s ease-out;
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        .chart-item {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .chart-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="font-poppins">
    
    <header class="text-white p-4 flex justify-between items-center flex-wrap">
        <h1 class="text-2xl font-bold">Number-Cal: Chart Store</h1>
        <nav class="flex gap-4">
            <a href="charts.html" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-300">
                Chart Editor
            </a>
            <a href="info.html" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-300">
                View Tables
            </a>
            <a href="pattern.html" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-300">
                Pattern Finder
            </a>
        </nav>
    </header>

    <div class="store-body container mx-auto p-4 md:p-8">
        <h2 class="text-4xl font-extrabold text-center mb-10 text-white">
            <span class="inline-block bg-yellow-500 text-gray-800 px-4 py-2 rounded-xl shadow-lg transform rotate-[-2deg]">
                Your Saved Charts
            </span>
        </h2>

        <div class="flex justify-end mb-6">
            <button id="deleteAllBtn" class="bg-red-700 text-white py-2 px-4 rounded-lg hover:bg-red-800 transition-colors duration-300 font-semibold shadow-md">
                Delete All Charts
            </button>
        </div>

        <div id="chart-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <p id="no-charts-message" class="col-span-full text-center text-xl text-white opacity-80 p-8 border border-white/20 rounded-xl bg-black/10 shadow-inner hidden">
                You haven't saved any charts yet. Go to the Chart Editor to create one!
            </p>
        </div>
    </div>

    <script>
        const chartList = document.getElementById('chart-list');
        const noChartsMessage = document.getElementById('no-charts-message');
        const deleteAllBtn = document.getElementById('deleteAllBtn');

        // Function to handle click on "Edit" (or view)
        function loadChart(label) {
            // Save the selected chart label to localStorage for charts.html to pick up
            localStorage.setItem('chartToLoad', label); 
            window.location.href = 'charts.html'; 
        }

        // Function to handle click on "Analyze" (or link to pattern.html)
        function analyzeChart(label) {
            // Save the selected chart label to localStorage for pattern.html to pick up
            localStorage.setItem('chartToLoadForAnalysis', label); 
            window.location.href = 'pattern.html'; 
        }

        function renderChartList() {
            const history = JSON.parse(localStorage.getItem('chartHistory')) || {};
            const labels = Object.keys(history).sort(); // Sort by label alphabetically
            
            chartList.innerHTML = ''; // Clear previous list

            if (labels.length === 0) {
                noChartsMessage.classList.remove('hidden');
                deleteAllBtn.classList.add('hidden');
                return;
            }

            noChartsMessage.classList.add('hidden');
            deleteAllBtn.classList.remove('hidden');

            labels.forEach(label => {
                const chartData = history[label];
                const chartItem = document.createElement('div');
                chartItem.className = 'chart-item p-6 bg-white rounded-xl shadow-xl flex flex-col space-y-4';
                chartItem.onclick = () => loadChart(label); // Make the entire card clickable to load/edit

                chartItem.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-900">${label}</h3>
                    <p class="text-sm text-gray-600">Rows: ${chartData.rows}, Columns: ${chartData.cols}</p>
                    <div class="flex gap-3 mt-auto">
                        <button class="bg-blue-500 text-white py-1 px-3 rounded hover:bg-blue-600 transition-colors duration-300" onclick="event.stopPropagation(); loadChart('${label}')">
                            Edit/View
                        </button>
                        <button class="bg-indigo-500 text-white py-1 px-3 rounded hover:bg-indigo-600 transition-colors duration-300 font-semibold" onclick="event.stopPropagation(); analyzeChart('${label}')">
                            Analyze Pattern
                        </button>
                    </div>
                `;
                
                const deleteButton = document.createElement('button');
                deleteButton.className = 'bg-red-500 text-white py-1 px-3 rounded hover:bg-red-600 transition-colors duration-300';
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = (e) => {
                    e.stopPropagation();
                    const confirmDelete = confirm(`Are you sure you want to delete the chart \"${label}\"?`);
                    if (confirmDelete) {
                        deleteChart(label);
                    }
                };

                // Inject Delete button into the card's action buttons div
                const actionDiv = chartItem.querySelector('.flex.gap-3.mt-auto');
                if(actionDiv) {
                     actionDiv.appendChild(deleteButton);
                }
                
                chartList.appendChild(chartItem);
            });
        }

        function deleteChart(label) {
            const history = JSON.parse(localStorage.getItem('chartHistory')) || {};
            delete history[label];
            localStorage.setItem('chartHistory', JSON.stringify(history));
            renderChartList();
        }
        
        deleteAllBtn.addEventListener('click', () => {
            const confirmDelete = confirm("Are you sure you want to delete ALL your saved charts? This action cannot be undone.");
            if (confirmDelete) {
                localStorage.removeItem('chartHistory');
                renderChartList();
            }
        });

        renderChartList();
    </script>
</body>
</html>
